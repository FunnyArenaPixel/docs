import{useLocaleConfig as ee,isString as te,isPlainObject as se}from"@vuepress/helper/client";import{useLocalStorage as $,useDebounceFn as le,useEventListener as re}from"@vueuse/core";import{ref as L,shallowRef as ae,onMounted as ue,watch as _,onUnmounted as oe,defineComponent as ie,toRef as ne,reactive as ce,computed as P,h as s}from"vue";import{useRouter as F}from"vue-router";import{useRouteLocale as U}from"vuepress/client";import{VPLink as M}from"vuepress-shared/client";import{H as Y,C as j,S as ve,T as pe,a as he,b as ye}from"../closeIcon-sf_efdRb.js";import{s as b,u as de,c as me,a as fe,b as He}from"../index-JkSz3odU.js";import"../styles/search-result.scss";const ge="SEARCH_PRO_QUERY_HISTORY",y=$(ge,[]),Re=()=>{const{queryHistoryCount:u}=b,n=u>0;return{enabled:n,queryHistory:y,addQueryHistory:r=>{n&&(y.value.length<u?y.value=Array.from(new Set([r,...y.value])):y.value=Array.from(new Set([r,...y.value.slice(0,u-1)])))},removeQueryHistory:r=>{y.value=[...y.value.slice(0,r),...y.value.slice(r+1)]}}},Se="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:O}=b,d=$(Se,[]),ke=()=>{const u=F(),n=O>0,r=l=>u.resolve({name:l.key,..."anchor"in l?{hash:`#${l.anchor}`}:{}}).fullPath;return{enabled:n,resultHistory:d,addResultHistory:l=>{if(n){const o={link:r(l),display:l.display};"header"in l&&(o.header=l.header),d.value.length<O?d.value=[o,...d.value]:d.value=[o,...d.value.slice(0,O-1)]}},removeResultHistory:l=>{d.value=[...d.value.slice(0,l),...d.value.slice(l+1)]}}},Qe=u=>{const n=de(),r=U(),{search:l,terminate:o}=me(),f=L(!1),H=ae([]);return ue(()=>{const m=()=>{H.value=[],f.value=!1},Q=le(g=>{f.value=!0,g?l({type:"search",query:g,locale:r.value,options:n}).then(h=>{H.value=h,f.value=!1}).catch(h=>{console.error(h),m()}):m()},b.searchDelay);_([u,r],()=>Q(u.value),{immediate:!0}),oe(()=>{o()})}),{searching:f,results:H}};var Ce=ie({name:"SearchResult",props:{query:{type:String,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(u,{emit:n}){const r=F(),l=U(),o=ee(fe),{enabled:f,addQueryHistory:H,queryHistory:m,removeQueryHistory:Q}=Re(),{enabled:g,resultHistory:h,addResultHistory:A,removeResultHistory:V}=ke(),I=f||g,C=ne(u,"query"),{results:R,searching:W}=Qe(C),a=ce({isQuery:!0,index:0}),p=L(0),c=L(0),T=P(()=>I&&(m.value.length>0||h.value.length>0)),x=P(()=>R.value.length>0),w=P(()=>R.value[p.value]||null),D=e=>r.resolve({name:e.key,..."anchor"in e?{hash:`#${e.anchor}`}:{}}).fullPath,B=()=>{const{isQuery:e,index:t}=a;t===0?(a.isQuery=!e,a.index=e?h.value.length-1:m.value.length-1):a.index=t-1},N=()=>{const{isQuery:e,index:t}=a;t===(e?m.value.length-1:h.value.length-1)?(a.isQuery=!e,a.index=0):a.index=t+1},z=()=>{p.value=p.value>0?p.value-1:R.value.length-1,c.value=w.value.contents.length-1},G=()=>{p.value=p.value<R.value.length-1?p.value+1:0,c.value=0},J=()=>{c.value<w.value.contents.length-1?c.value=c.value+1:G()},K=()=>{c.value>0?c.value=c.value-1:z()},q=e=>e.map(t=>te(t)?t:s(t[0],t[1])),X=e=>{if(e.type==="customField"){const t=He[e.index]||"$content",[i,k=""]=se(t)?t[l.value].split("$content"):t.split("$content");return e.display.map(v=>s("div",q([i,...v,k])))}return e.display.map(t=>s("div",q(t)))},S=()=>{p.value=0,c.value=0,n("updateQuery",""),n("close")};return re("keydown",e=>{if(u.isFocusing){if(x.value){if(e.key==="ArrowUp")K();else if(e.key==="ArrowDown")J();else if(e.key==="Enter"){const t=w.value.contents[c.value],i=D(t);H(u.query),A(t),r.push(i),S()}}else if(g){if(e.key==="ArrowUp")B();else if(e.key==="ArrowDown")N();else if(e.key==="Enter"){const{index:t}=a;a.isQuery?(n("updateQuery",m.value[t]),e.preventDefault()):(r.push(h.value[t].link),S())}}}}),_([p,c],()=>{document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active")?.scrollIntoView(!1)},{flush:"post"}),()=>s("div",{class:["search-pro-result-wrapper",{empty:C.value?!x.value:!T.value}],id:"search-pro-results"},C.value===""?I?T.value?[f?s("ul",{class:"search-pro-result-list"},s("li",{class:"search-pro-result-list-item"},[s("div",{class:"search-pro-result-title"},o.value.queryHistory),m.value.map((e,t)=>s("div",{class:["search-pro-result-item",{active:a.isQuery&&a.index===t}],onClick:()=>{n("updateQuery",e)}},[s(Y,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},e),s("button",{class:"search-pro-remove-icon",innerHTML:j,onClick:i=>{i.preventDefault(),i.stopPropagation(),Q(t)}})]))])):null,g?s("ul",{class:"search-pro-result-list"},s("li",{class:"search-pro-result-list-item"},[s("div",{class:"search-pro-result-title"},o.value.resultHistory),h.value.map((e,t)=>s(M,{to:e.link,class:["search-pro-result-item",{active:!a.isQuery&&a.index===t}],onClick:()=>{S()}},()=>[s(Y,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},[e.header?s("div",{class:"content-header"},e.header):null,s("div",e.display.map(i=>q(i)).flat())]),s("button",{class:"search-pro-remove-icon",innerHTML:j,onClick:i=>{i.preventDefault(),i.stopPropagation(),V(t)}})]))])):null]:o.value.emptyHistory:o.value.emptyResult:W.value?s(ve,{hint:o.value.searching}):x.value?s("ul",{class:"search-pro-result-list"},R.value.map(({title:e,contents:t},i)=>{const k=p.value===i;return s("li",{class:["search-pro-result-list-item",{active:k}]},[s("div",{class:"search-pro-result-title"},e||o.value.defaultTitle),t.map((v,Z)=>{const E=k&&c.value===Z;return s(M,{to:D(v),class:["search-pro-result-item",{active:E,"aria-selected":E}],onClick:()=>{H(u.query),A(v),S()}},()=>[v.type==="text"?null:s(v.type==="title"?pe:v.type==="heading"?he:ye,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},[v.type==="text"&&v.header?s("div",{class:"content-header"},v.header):null,s("div",X(v))])])})])})):o.value.emptyResult)}});export{Ce as default};
//# sourceMappingURL=SearchResult.js.map
