import{search as C,getStoredFields as R,autoSuggest as T,loadJSONIndex as w}from"slimsearch";import $ from"@temp/search-pro/index";import{entries as E}from"@vuepress/helper/client";const x=(l,e)=>{const n=l.toLowerCase(),s=e.toLowerCase(),o=[];let t=0,r=0;const i=(c,g=!1)=>{let p="";r===0?p=c.length>20?`… ${c.slice(-20)}`:c:g?p=c.length+r>100?`${c.slice(0,100-r)}… `:c:p=c.length>20?`${c.slice(0,20)} … ${c.slice(-20)}`:c,p&&o.push(p),r+=p.length,g||(o.push(["mark",e]),r+=e.length,r>=100&&o.push(" …"))};let h=n.indexOf(s,t);if(h===-1)return null;for(;h>=0;){const c=h+s.length;if(i(l.slice(t,h)),t=c,r>100)break;h=n.indexOf(s,t)}return r<100&&i(l.slice(t),!0),o},S=/[\u4e00-\u9fa5]/g,M=(l={})=>({fuzzy:.2,prefix:!0,processTerm:e=>{const n=e.match(S)||[],s=e.replace(S,"").toLowerCase();return s?[s,...n]:[...n]},...l}),F=(l,e)=>e.contents.reduce((n,[,s])=>n+s,0)-l.contents.reduce((n,[,s])=>n+s,0),_=(l,e)=>Math.max(...e.contents.map(([,n])=>n))-Math.max(...l.contents.map(([,n])=>n)),O=(l,e,n={})=>{const s={};return C(e,l,M({boost:{h:2,t:1,c:4},...n})).forEach(o=>{const{id:t,terms:r,score:i}=o,h=t.includes("@"),c=t.includes("#"),[g,p]=t.split(/[#@]/),m=r.sort((u,a)=>u.length-a.length).filter((u,a)=>r.slice(a+1).every(f=>!f.includes(u))),{contents:d}=s[g]??={title:"",contents:[]};if(h)d.push([{type:"customField",key:g,index:p,display:m.map(u=>o.c.map(a=>x(a,u))).flat().filter(u=>u!==null)},i]);else{const u=m.map(a=>x(o.h,a)).filter(a=>a!==null);if(u.length&&d.push([{type:c?"heading":"title",key:g,...c&&{anchor:p},display:u},i]),"t"in o)for(const a of o.t){const f=m.map(y=>x(a,y)).filter(y=>y!==null);f.length&&d.push([{type:"text",key:g,...c&&{anchor:p},display:f},i])}}}),E(s).sort(([,o],[,t])=>SEARCH_PRO_SORT_STRATEGY==="total"?F(o,t):_(o,t)).map(([o,{title:t,contents:r}])=>{if(!t){const i=R(e,o);i&&(t=i.h)}return{title:t,contents:r.map(([i])=>i)}})},k=(l,e,n={})=>T(e,l,M(n)).map(({suggestion:s})=>s);self.onmessage=async({data:{type:l="all",query:e,locale:n,options:s}})=>{const{default:o}=await $[n](),t=w(o,{fields:["h","t","c"],storeFields:["h","t","c"]});l==="suggest"?self.postMessage(k(e,t,s)):l==="search"?self.postMessage(O(e,t,s)):self.postMessage({suggestions:k(e,t,s),results:O(e,t,s)})};
//# sourceMappingURL=index.js.map
